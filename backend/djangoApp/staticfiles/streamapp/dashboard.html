<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>실시간 차량 감지 (디버그 모드)</title>
	</head>
	<body>
		<h1>WebSocket 스트리밍 (디버그 ON)</h1>
		<img id="video" width="640" height="480" />
		<p>OCR: <span id="plate-text">대기 중...</span></p>

		<script>
			console.log("[CLIENT] 페이지 로드, WS 연결 시도…");
			const ws = new WebSocket("ws://localhost:8000/ws/stream/");

			ws.onopen = () => {
				console.log("[CLIENT] WebSocket OPEN");
			};
			ws.onerror = (err) => {
				console.error("[CLIENT] WebSocket ERROR", err);
			};
			ws.onclose = (evt) => {
				console.warn("[CLIENT] WebSocket CLOSED", evt);
			};
			ws.onmessage = (evt) => {
				console.log("[CLIENT] 메시지 수신:");
				// console.log("[CLIENT] 메시지 수신:", evt.data);
				try {
					const { image, text } = JSON.parse(evt.data);
					document.getElementById("video").src = "data:image/jpeg;base64," + image;
					document.getElementById("plate-text").innerText = text;
				} catch (e) {
					console.error("[CLIENT] 데이터 파싱 실패:", e);
				}
			};
		</script>
	</body>
</html>
