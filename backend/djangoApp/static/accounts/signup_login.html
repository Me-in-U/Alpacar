<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="UTF-8" />
		<title>JWT 테스트 페이지</title>
		<style>
			body {
				margin: 0;
				font-family: Arial, sans-serif;
			}
			.pane {
				width: 100%;
				padding: 20px;
				box-sizing: border-box;
			}
			h2 {
				margin: 10px 0;
			}
			button {
				margin: 5px 0;
			}
			input {
				display: block;
				margin: 5px 0;
				padding: 8px;
				width: 100%;
				box-sizing: border-box;
			}
		</style>
	</head>
	<body>
		<div class="pane">
			<h2>회원가입(Signup + JWT)</h2>
			<button onclick="fillSignup()">랜덤 채우기</button>
			<form onsubmit="onSignup(event)">
				<input id="su_name" placeholder="이름 (full_name)" />
				<input id="su_email" placeholder="이메일" />
				<input id="su_pass" type="password" placeholder="비밀번호" />
				<input id="su_pass2" type="password" placeholder="비밀번호 확인" />
				<input id="su_phone" placeholder="전화번호" />
				<input id="su_nickname" placeholder="닉네임" />
				<button type="submit">가입</button>
			</form>

			<h2>로그인(Login + JWT)</h2>
			<button onclick="fillLogin()">랜덤 채우기</button>
			<form onsubmit="onLogin(event)">
				<!-- id를 li_email / li_pass 로 통일 -->
				<input id="li_email" placeholder="Email" />
				<input id="li_pass" type="password" placeholder="Password" />
				<button type="submit">로그인</button>
			</form>
			<!-- 소셜 로그인 테스트 섹션 추가 -->
			<h2>소셜 로그인 테스트</h2>
			<!-- Google 로그인 -->
			<button id="btn_google_login">Google로 로그인</button>
			<!-- Kakao 로그인 -->
			<button id="btn_kakao_login">Kakao로 로그인</button>
		</div>
	</body>
	<script>
		const API = "http://localhost:8000";

		function rand(len) {
			return Math.random().toString(36).substr(2, len);
		}

		// 랜덤 채우기
		function fillSignup() {
			document.getElementById("su_name").value = rand(6);
			document.getElementById("su_nickname").value = rand(6);
			document.getElementById("su_email").value = rand(5) + "@test.com";
			document.getElementById("su_pass").value = rand(8);
			document.getElementById("su_phone").value = "010" + ("" + Math.floor(Math.random() * 1e8)).padStart(8, "0");
			document.getElementById("su_plate").value = "12가" + ("" + Math.floor(Math.random() * 1e4)).padStart(4, "0");
		}

		async function onSignup(e) {
			e.preventDefault();
			const data = {
				full_name: su_name.value,
				email: su_email.value,
				password: su_pass.value,
				password2: su_pass2.value,
				phone: su_phone.value,
				nickname: su_nickname.value,
			};
			const result = await fetch(`${API}/api/auth/signup/`, {
				method: "POST",
				headers: { "Content-Type": "application/json" },
				body: JSON.stringify(data),
			});
			const json = await result.json();
			if (result.ok) {
				alert("회원가입 성공! 이제 로그인해주세요.");
			} else {
				alert("실패: " + JSON.stringify(json));
			}
		}

		function fillLogin() {
			document.getElementById("li_email").value = rand(5) + "@test.com";
			document.getElementById("li_pass").value = rand(8);
		}

		async function onLogin(e) {
			e.preventDefault();
			const email = document.getElementById("li_email").value;
			const password = document.getElementById("li_pass").value;

			const result = await fetch(`${API}/api/auth/login/`, {
				method: "POST",
				headers: { "Content-Type": "application/json" },
				body: JSON.stringify({ email, password }),
			});
			const json = await result.json();

			if (result.ok) {
				localStorage.setItem("access_token", json.access);
				localStorage.setItem("refresh_token", json.refresh);
				// SPA 라우터 대신 단순 이동
				window.location.href = "/static/accounts/push_setting.html";
			} else {
				alert("실패: " + JSON.stringify(json));
			}
		}
		document.getElementById("btn_google_login").addEventListener("click", () => {
			window.location.href = `${API}/api/auth/social/google/login/`;
		});

		document.getElementById("btn_kakao_login").addEventListener("click", async () => {
			const res = await fetch(`${API}/api/auth/social/kakao/login_url/`);
			const { url } = await res.json();
			window.location.href = url;
		});
	</script>
</html>
